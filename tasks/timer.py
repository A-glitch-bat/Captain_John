import time
import os
import sys
import pygame
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))
import config

# ASCII art digits
digits = {
    '0': ["  ▄▄▄▄▄▄▄▄▄  ",
          " ▐░░░░░░░░░▌ ",
          "▐░█░█▀▀▀▀▀█░▌",
          "▐░▌▐░▌    ▐░▌",
          "▐░▌ ▐░▌   ▐░▌",
          "▐░▌  ▐░▌  ▐░▌",
          "▐░▌   ▐░▌ ▐░▌",
          "▐░▌    ▐░▌▐░▌",
          "▐░█▄▄▄▄▄█░█░▌",
          " ▐░░░░░░░░░▌ ",
          "  ▀▀▀▀▀▀▀▀▀  "],
    '1': ["    ▄▄▄▄     ",
          "  ▄█░░░░▌    ",
          " ▐░░▌▐░░▌    ",
          "  ▀▀ ▐░░▌    ",
          "     ▐░░▌    ",
          "     ▐░░▌    ",
          "     ▐░░▌    ",
          "     ▐░░▌    ",
          " ▄▄▄▄█░░█▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '2': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          "          ▐░▌",
          " ▄▄▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀▀▀ ",
          "▐░█▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '3': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          " ▄▄▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          " ▄▄▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '4': [" ▄         ▄ ",
          "▐░▌       ▐░▌",
          "▐░▌       ▐░▌",
          "▐░▌       ▐░▌",
          "▐░█▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          "          ▐░▌",
          "          ▐░▌",
          "           ▀ "],
    '5': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀▀▀ ",
          "▐░█▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          "          ▐░▌",
          " ▄▄▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '6': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀▀▀ ",
          "▐░▌          ",
          "▐░█▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀█░▌",
          "▐░▌       ▐░▌",
          "▐░█▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '7': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "         ▐░▌ ",
          "        ▐░▌  ",
          "       ▐░▌   ",
          "      ▐░▌    ",
          "     ▐░▌     ",
          "    ▐░▌      ",
          "   ▐░▌       ",
          "    ▀        "],
    '8': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀█░▌",
          "▐░▌       ▐░▌",
          "▐░█▄▄▄▄▄▄▄█░▌",
          " ▐░░░░░░░░░▌ ",
          "▐░█▀▀▀▀▀▀▀█░▌",
          "▐░▌       ▐░▌",
          "▐░█▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    '9': [" ▄▄▄▄▄▄▄▄▄▄▄ ",
          "▐░░░░░░░░░░░▌",
          "▐░█▀▀▀▀▀▀▀█░▌",
          "▐░▌       ▐░▌",
          "▐░█▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀█░▌",
          "          ▐░▌",
          " ▄▄▄▄▄▄▄▄▄█░▌",
          "▐░░░░░░░░░░░▌",
          " ▀▀▀▀▀▀▀▀▀▀▀ "],
    ':': ["     ",
          "     ",
          "  ▄  ",
          " ▐░▌ ",
          "  ▀  ",
          "     ",
          "  ▄  ",
          " ▐░▌ ",
          "  ▀  ",
          "     ",
          "     "],
}

def print_ascii_clock(time_str):
    """
    ASCII clock prints
    """
    lines = ["", "", "", "", "", "", "", "", "", "", ""]
    for char in time_str:
        for i in range(11):
            lines[i] += digits[char][i] + "  "

    os.system('cls' if os.name == 'nt' else 'clear')
    for line in lines:
        print(line)

def timer(seconds):
    """
    main timer function
    """
    while seconds >= 0:
        mins, secs = divmod(seconds, 60)
        time_str = f"{mins:02d}:{secs:02d}"
        print_ascii_clock(time_str)
        time.sleep(1)
        seconds -= 1
    
    # sound timer and exit window
    audio_path = os.path.join(config.base_folder, "audio/success.mp3")
    pygame.mixer.init()
    pygame.mixer.Sound(audio_path).set_volume(0.5)
    sound = pygame.mixer.Sound(audio_path)
    sound.play()
    sys.exit(0)

# Temporary main
if __name__ == "__main__":
    timer(120) # 2 minute timer
